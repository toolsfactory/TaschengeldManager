<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:TaschengeldManager.Mobile.ViewModels.Parent"
             x:Class="TaschengeldManager.Mobile.Views.Pages.Parent.ParentExpensePage"
             x:DataType="vm:ParentExpenseViewModel"
             Title="Ausgabe erfassen">

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Abbrechen" Command="{Binding CancelCommand}" />
    </ContentPage.ToolbarItems>

    <ScrollView>
        <VerticalStackLayout Spacing="16" Padding="16">

            <!-- Header -->
            <Label Text="{Binding ChildName, StringFormat='Ausgabe für {0}'}"
                   Style="{StaticResource PageTitle}"
                   HorizontalTextAlignment="Center" />

            <!-- Current Balance Info -->
            <Border Style="{StaticResource Card}"
                    Padding="16"
                    BackgroundColor="{StaticResource Gray100}">
                <HorizontalStackLayout HorizontalOptions="Center" Spacing="8">
                    <Label Text="Verfügbar:"
                           TextColor="{StaticResource Gray600}" />
                    <Label Text="{Binding FormattedCurrentBalance}"
                           FontAttributes="Bold"
                           TextColor="{StaticResource Primary}" />
                </HorizontalStackLayout>
            </Border>

            <!-- Amount Input -->
            <Border Style="{StaticResource Card}"
                    Padding="24">
                <VerticalStackLayout Spacing="16">
                    <Label Text="Betrag"
                           Style="{StaticResource SectionTitle}"
                           HorizontalOptions="Center"
                           Margin="0" />

                    <Entry Text="{Binding Amount}"
                           Placeholder="0,00"
                           Keyboard="Numeric"
                           FontSize="32"
                           FontAttributes="Bold"
                           HorizontalTextAlignment="Center"
                           HorizontalOptions="Center"
                           WidthRequest="200" />

                    <Label Text="EUR"
                           TextColor="{StaticResource Gray500}"
                           HorizontalOptions="Center"
                           FontSize="14" />
                </VerticalStackLayout>
            </Border>

            <!-- Quick Amounts -->
            <VerticalStackLayout Spacing="8">
                <Label Text="Schnellauswahl"
                       Style="{StaticResource SectionTitle}" />

                <HorizontalStackLayout Spacing="12"
                                       HorizontalOptions="Center">
                    <Button Text="2 EUR"
                            Command="{Binding SetQuickAmountCommand}"
                            CommandParameter="2"
                            Style="{StaticResource SecondaryButton}"
                            WidthRequest="80" />
                    <Button Text="5 EUR"
                            Command="{Binding SetQuickAmountCommand}"
                            CommandParameter="5"
                            Style="{StaticResource SecondaryButton}"
                            WidthRequest="80" />
                    <Button Text="10 EUR"
                            Command="{Binding SetQuickAmountCommand}"
                            CommandParameter="10"
                            Style="{StaticResource SecondaryButton}"
                            WidthRequest="80" />
                    <Button Text="20 EUR"
                            Command="{Binding SetQuickAmountCommand}"
                            CommandParameter="20"
                            Style="{StaticResource SecondaryButton}"
                            WidthRequest="80" />
                </HorizontalStackLayout>
            </VerticalStackLayout>

            <!-- Description -->
            <VerticalStackLayout Spacing="8">
                <Label Text="Beschreibung (optional)"
                       Style="{StaticResource SectionTitle}" />

                <Entry Text="{Binding Description}"
                       Placeholder="z.B. Eiscreme, Comic, etc."
                       MaxLength="200" />
            </VerticalStackLayout>

            <!-- Category -->
            <VerticalStackLayout Spacing="8">
                <Label Text="Kategorie"
                       Style="{StaticResource SectionTitle}" />

                <Picker ItemsSource="{Binding Categories}"
                        SelectedItem="{Binding SelectedCategory}"
                        Title="Kategorie auswählen" />
            </VerticalStackLayout>

            <!-- Validation Error -->
            <Label Text="{Binding ValidationError}"
                   TextColor="{StaticResource Error}"
                   IsVisible="{Binding ValidationError, Converter={StaticResource IsNotNullConverter}}"
                   HorizontalTextAlignment="Center" />

            <!-- Error Message -->
            <Border IsVisible="{Binding HasError}"
                    BackgroundColor="{StaticResource Error}"
                    Padding="12"
                    Margin="0,8">
                <Label Text="{Binding ErrorMessage}"
                       TextColor="White"
                       HorizontalTextAlignment="Center" />
            </Border>

            <!-- Submit Button -->
            <Button Text="Ausgabe erfassen"
                    Command="{Binding SubmitCommand}"
                    IsEnabled="{Binding CanSubmit}"
                    Style="{StaticResource PrimaryButton}"
                    Margin="0,16,0,0" />

            <!-- Loading Indicator -->
            <ActivityIndicator IsRunning="{Binding IsBusy}"
                               IsVisible="{Binding IsBusy}"
                               Color="{StaticResource Primary}" />

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
